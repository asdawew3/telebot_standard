{% extends "base.html" %}

{% set show_navbar = false %}

{% block title %}系统错误 - Telegram Bot管理系统{% endblock %}

{% block page_title %}系统错误{% endblock %}

{% block extra_css %}
<style>
/* 错误页面特殊样式 */
body {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}

.header {
    display: none;
}

.container {
    max-width: 600px;
    padding: 0;
}

.error-container {
    background-color: #1e1e1e;
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
    padding: 30px;
    text-align: center;
}

.error-code {
    font-size: 72px;
    color: #f44336;
    margin-bottom: 20px;
    font-weight: bold;
}

.error-title {
    font-size: 24px;
    font-weight: 500;
    margin-bottom: 15px;
    color: #ffffff;
}

.error-message {
    font-size: 16px;
    margin-bottom: 30px;
    color: #aaaaaa;
    line-height: 1.5;
}

.error-details {
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid #333;
    font-size: 14px;
    color: #666666;
}

.error-background {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: -1;
    opacity: 0.1;
}

#error-particles {
    width: 100%;
    height: 100%;
    position: relative;
    overflow: hidden;
}

.particle {
    position: absolute;
    width: 2px;
    height: 2px;
    background: #f44336;
    border-radius: 50%;
    animation: float 10s infinite linear;
}

@keyframes float {
    0% {
        transform: translateY(100vh) rotate(0deg);
        opacity: 0;
    }
    10% {
        opacity: 1;
    }
    90% {
        opacity: 1;
    }
    100% {
        transform: translateY(-100vh) rotate(360deg);
        opacity: 0;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="error-container">
    <div class="error-code" id="error-code">
        {% if error_code == '404' %}
        404
        {% elif error_code == '403' %}
        403
        {% elif error_code == '500' %}
        500
        {% elif error_code == 'PERMISSION_DENIED' %}
        🚫
        {% elif error_code == 'INTERNAL_ERROR' %}
        ⚠️
        {% else %}
        ERROR
        {% endif %}
    </div>
    
    <h1 class="error-title" id="error-title">
        {% if error_code == '404' %}
        页面未找到
        {% elif error_code == '403' %}
        访问被拒绝
        {% elif error_code == '500' %}
        内部服务器错误
        {% elif error_code == 'PERMISSION_DENIED' %}
        权限不足
        {% elif error_code == 'INTERNAL_ERROR' %}
        系统内部错误
        {% else %}
        系统错误
        {% endif %}
    </h1>
    
    <div class="error-message" id="error-message">
        {{ error_message or '发生未知错误，请稍后重试。' }}
    </div>
    
    <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
        <a href="javascript:history.back()" class="btn btn-secondary">返回上页</a>
        <a href="{{ url_for('index') }}" class="btn btn-primary">返回首页</a>
        {% if current_user and current_user.is_authenticated %}
        <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">控制台</a>
        {% else %}
        <a href="{{ url_for('login_page') }}" class="btn btn-secondary">重新登录</a>
        {% endif %}
    </div>
    
    {% if error_code %}
    <div class="error-details">
        <p>错误代码: {{ error_code }}</p>
        <p style="font-size: 12px;">如果问题持续存在，请联系系统管理员</p>
    </div>
    {% endif %}
</div>

<!-- 错误背景效果 -->
<div class="error-background">
    <div id="error-particles"></div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// 错误页面粒子效果
function createErrorParticles() {
    const container = document.getElementById('error-particles');
    if (!container) return;
    
    // 创建20个粒子
    for (let i = 0; i < 20; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        
        // 随机位置和动画延迟
        particle.style.left = Math.random() * 100 + '%';
        particle.style.animationDelay = Math.random() * 10 + 's';
        particle.style.animationDuration = (Math.random() * 5 + 5) + 's';
        
        container.appendChild(particle);
    }
}

// 页面加载完成后初始化
document.addEventListener('DOMContentLoaded', function() {
    createErrorParticles();
    
    // 自动记录错误信息到控制台
    console.error('页面错误:', {
        code: '{{ error_code or "UNKNOWN" }}',
        message: '{{ error_message or "发生未知错误" }}',
        url: window.location.href,
        timestamp: new Date().toISOString()
    });
});
</script>
{% endblock %}